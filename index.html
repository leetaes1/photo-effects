<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ink Blob & Dot Generator</title>
    <style>
        :root {
            --sidebar-width: 350px;
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --accent: #e91e63;
            --text-main: #ffffff;
        }

        body {
            margin: 0; font-family: 'Pretendard', sans-serif;
            background: var(--bg-dark); color: var(--text-main);
            display: flex; height: 100vh; overflow: hidden;
        }

        /* ì™¼ìª½ ì‚¬ì´ë“œë°” */
        .sidebar {
            width: var(--sidebar-width); background: var(--panel-bg);
            padding: 25px; box-sizing: border-box; display: flex;
            flex-direction: column; gap: 18px; overflow-y: auto;
            border-right: 1px solid #333;
        }

        h2 { margin: 0; font-size: 1.5rem; color: var(--accent); }
        .desc { font-size: 0.85rem; color: #aaa; line-height: 1.4; }

        .control-item { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 0.9rem; display: flex; justify-content: space-between; }
        label span { font-weight: bold; color: var(--accent); }

        input[type="range"] { width: 100%; accent-color: var(--accent); cursor: pointer; }
        
        .checkbox-group { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }

        button {
            padding: 12px; border-radius: 8px; border: none; font-weight: bold;
            cursor: pointer; transition: 0.3s; font-size: 0.9rem;
        }
        .btn-upload { background: #333; color: white; border: 1px dashed #666; }
        .btn-process { background: var(--accent); color: white; margin-top: 10px; }
        .btn-download { background: #444; color: white; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .main-content {
            flex: 1; display: flex; align-items: center; justify-content: center;
            background: #000; position: relative; padding: 20px;
        }
        canvas {
            max-width: 100%; max-height: 90vh;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            background: white; /* ê²°ê³¼ë¬¼ ê°€ë…ì„±ì„ ìœ„í•´ ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì • */
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Ink Blot Tool</h2>
        <p class="desc">í”½ì…€ì˜ ë°ê¸°ë¥¼ ê³„ì‚°í•˜ì—¬ ì–´ë‘ìš´ ì˜ì—­ì— ê²€ì€ ì ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>

        <button class="btn-upload" onclick="document.getElementById('fileInput').click()">ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ</button>
        <input type="file" id="fileInput" hidden accept="image/*">

        <div class="control-item">
            <label>ì  ë°€ë„ (Grid Size) <span id="v-density">10</span></label>
            <input type="range" id="density" min="5" max="50" value="10">
            <small class="desc">ê°’ì´ ì‘ì„ìˆ˜ë¡ ì ì´ ì´˜ì´˜í•´ì§‘ë‹ˆë‹¤.</small>
        </div>

        <div class="control-item">
            <label>ìµœëŒ€ ì  í¬ê¸° (Max Size) <span id="v-maxSize">8</span></label>
            <input type="range" id="maxSize" min="1" max="30" value="8">
        </div>

        <div class="control-item">
            <label>ë°ê¸° ëŒ€ë¹„ (Contrast) <span id="v-contrast">1.0</span></label>
            <input type="range" id="contrast" min="0.1" max="3.0" step="0.1" value="1.0">
        </div>

        <label class="checkbox-group">
            <input type="checkbox" id="invert"> ìƒ‰ìƒ ë°˜ì „ (ë°ì€ ê³³ì— ì  ìƒì„±)
        </label>

        <button class="btn-process" id="processBtn">âš¡ ì´ë¯¸ì§€ ì „í™˜í•˜ê¸°</button>
        <button class="btn-download" id="downloadBtn">ğŸ’¾ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>

        <p class="desc" style="margin-top: auto; padding-top: 20px; border-top: 1px solid #333;">
            ê³µì‹: $Y = 0.299R + 0.587G + 0.114B$<br>
            ì–´ë‘ìš´ í”½ì…€ì¼ìˆ˜ë¡ ë” í° ì›ì„ ê·¸ë¦¬ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
        </p>
    </div>

    <div class="main-content">
        <canvas id="mainCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        
        let originalImg = null;

        // ìŠ¬ë¼ì´ë” ê°’ ì‹¤ì‹œê°„ í‘œì‹œ
        document.querySelectorAll('input[type="range"]').forEach(input => {
            input.oninput = (e) => {
                document.getElementById('v-' + e.target.id).innerText = e.target.value;
            };
        });

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    originalImg = img;
                    // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ì´ë¯¸ì§€ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.fillStyle = "white";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        };

        document.getElementById('processBtn').onclick = () => {
            if(!originalImg) {
                alert("ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!");
                return;
            }
            
            const density = parseInt(document.getElementById('density').value);
            const maxSize = parseInt(document.getElementById('maxSize').value);
            const contrast = parseFloat(document.getElementById('contrast').value);
            const invert = document.getElementById('invert').checked;

            // ì›ë³¸ ë°ì´í„° ë¶„ì„ì„ ìœ„í•œ ì„ì‹œ ìº”ë²„ìŠ¤
            const tempCanvas = document.createElement('canvas');
            const tCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            tCtx.drawImage(originalImg, 0, 0);
            const imgData = tCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height).data;

            // ë©”ì¸ ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (í°ìƒ‰ ë°°ê²½)
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "black";

            // ê²©ì í˜•íƒœë¡œ ì´ë¯¸ì§€ ìŠ¤ìº”
            for (let y = 0; y < canvas.height; y += density) {
                for (let x = 0; x < canvas.width; x += density) {
                    const i = (y * canvas.width + x) * 4;
                    
                    // ë£¨ë¯¸ë„ŒìŠ¤ ê³„ì‚° (ë°ê¸°)
                    let brightness = (0.299 * imgData[i] + 0.587 * imgData[i+1] + 0.114 * imgData[i+2]) / 255;
                    
                    if (!invert) {
                        // ì–´ë‘ìš¸ìˆ˜ë¡ í° ì ì´ ìƒê¸°ë„ë¡ ìˆ˜ì¹˜ ë°˜ì „ (1 - brightness)
                        brightness = 1 - brightness;
                    }

                    // ëŒ€ë¹„ ì¡°ì •
                    const radius = Math.pow(brightness, contrast) * maxSize;

                    if (radius > 0.5) {
                        ctx.beginPath();
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
        };

        document.getElementById('downloadBtn').onclick = () => {
            const link = document.createElement('a');
            link.download = 'dot-art.png';
            link.href = canvas.toDataURL();
            link.click();
        };
    </script>
</body>
</html>
